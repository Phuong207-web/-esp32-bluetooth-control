<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2113.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.7px Arial; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
    span.s2 {font: 14.7px 'Apple Color Emoji'; font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1"><br>
&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;title&gt;ESP32 BLE Motor Control&lt;/title&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;style&gt;</span></p>
<p class="p1"><span class="s1">Â Â Â Â body { font-family: sans-serif; margin: 20px; }</span></p>
<p class="p1"><span class="s1">Â Â Â Â h1 { color: #333; }</span></p>
<p class="p1"><span class="s1">Â Â Â Â button { padding: 10px 20px; margin: 5px; font-size: 16px; }</span></p>
<p class="p1"><span class="s1">Â Â Â Â input[type=number] { padding: 5px; font-size: 16px; width: 100px; }</span></p>
<p class="p1"><span class="s1">Â Â Â Â .status { margin-top: 10px; font-weight: bold; }</span></p>
<p class="p1"><span class="s1">Â Â &lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;h1&gt;ESP32 BLE Motor Control&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">Â Â </span></p>
<p class="p1"><span class="s1">Â Â &lt;button id="connectBleButton"&gt;</span><span class="s2">ğŸ”Œ</span><span class="s1"> Connect BLE&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;button id="disconnectBleButton"&gt;</span><span class="s2">âŒ</span><span class="s1"> Disconnect&lt;/button&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â &lt;h2&gt;Motor Control&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;label for="rpmInput"&gt;Set RPM:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;input type="number" id="rpmInput" value="150" min="0" max="3000"&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;button id="sendRPMButton"&gt;Send RPM&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;p&gt;Last RPM Sent: &lt;span id="valueSent"&gt;None&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â &lt;h2&gt;Current RPM&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;p&gt;&lt;strong id="valueContainer"&gt;---&lt;/strong&gt; RPM&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">Â Â &lt;p&gt;Last update: &lt;span id="timestamp"&gt;Never&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â &lt;p class="status" id="bleState"&gt;Disconnected&lt;/p&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â &lt;script&gt;</span></p>
<p class="p1"><span class="s1">Â Â Â Â const connectButton = document.getElementById('connectBleButton');</span></p>
<p class="p1"><span class="s1">Â Â Â Â const disconnectButton = document.getElementById('disconnectBleButton');</span></p>
<p class="p1"><span class="s1">Â Â Â Â const sendRPMButton = document.getElementById('sendRPMButton');</span></p>
<p class="p1"><span class="s1">Â Â Â Â const bleState = document.getElementById('bleState');</span></p>
<p class="p1"><span class="s1">Â Â Â Â const valueSent = document.getElementById('valueSent');</span></p>
<p class="p1"><span class="s1">Â Â Â Â const valueContainer = document.getElementById('valueContainer');</span></p>
<p class="p1"><span class="s1">Â Â Â Â const timestamp = document.getElementById('timestamp');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â let bleServer;</span></p>
<p class="p1"><span class="s1">Â Â Â Â let bleService;</span></p>
<p class="p1"><span class="s1">Â Â Â Â let sensorCharacteristic;</span></p>
<p class="p1"><span class="s1">Â Â Â Â let ledCharacteristic;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â const serviceUUID = '19b10000-e8f2-537e-4f6c-d104768a1214';</span></p>
<p class="p1"><span class="s1">Â Â Â Â const sensorUUID = '19b10001-e8f2-537e-4f6c-d104768a1214';</span></p>
<p class="p1"><span class="s1">Â Â Â Â const ledUUID = '19b10002-e8f2-537e-4f6c-d104768a1214';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â connectButton.onclick = async () =&gt; {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â try {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â const device = await navigator.bluetooth.requestDevice({</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â Â Â filters: [{ services: [serviceUUID] }]</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleServer = await device.gatt.connect();</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleState.textContent = "Connected to " + device.name;</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleState.style.color = "green";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleService = await bleServer.getPrimaryService(serviceUUID);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â sensorCharacteristic = await bleService.getCharacteristic(sensorUUID);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â ledCharacteristic = await bleService.getCharacteristic(ledUUID);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â sensorCharacteristic.startNotifications();</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â sensorCharacteristic.addEventListener('characteristicvaluechanged', event =&gt; {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â Â Â const value = new TextDecoder().decode(event.target.value);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â Â Â valueContainer.textContent = value;</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â Â Â timestamp.textContent = new Date().toLocaleTimeString();</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â console.log("BLE connected and notifications started.");</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â } catch (error) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â console.error("BLE Connection Error:", error);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleState.textContent = "Connection failed";</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleState.style.color = "red";</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â }</span></p>
<p class="p1"><span class="s1">Â Â Â Â };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â disconnectButton.onclick = () =&gt; {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â if (bleServer &amp;&amp; bleServer.connected) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleServer.disconnect();</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleState.textContent = "Disconnected";</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â bleState.style.color = "red";</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â }</span></p>
<p class="p1"><span class="s1">Â Â Â Â };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â sendRPMButton.onclick = () =&gt; {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â const rpmValue = parseInt(document.getElementById("rpmInput").value);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â if (ledCharacteristic &amp;&amp; !isNaN(rpmValue)) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â ledCharacteristic.writeValue(Uint8Array.of(rpmValue));</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â valueSent.textContent = rpmValue + " RPM";</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â } else {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â alert("Invalid RPM or BLE not connected.");</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â }</span></p>
<p class="p1"><span class="s1">Â Â Â Â };</span></p>
<p class="p1"><span class="s1">Â Â &lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">UNO:<br>
#include &lt;Arduino.h&gt;</span></p>
<p class="p1"><span class="s1">#include &lt;BLEDevice.h&gt;</span></p>
<p class="p1"><span class="s1">#include &lt;BLEServer.h&gt;</span></p>
<p class="p1"><span class="s1">#include &lt;BLEUtils.h&gt;</span></p>
<p class="p1"><span class="s1">#include &lt;BLE2902.h&gt;</span></p>
<p class="p1"><span class="s1">#include &lt;PID_v1.h&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">#define ENA 5</span></p>
<p class="p1"><span class="s1">#define IN1 16</span></p>
<p class="p1"><span class="s1">#define IN2 17</span></p>
<p class="p1"><span class="s1">#define ENCODER_A 12</span></p>
<p class="p1"><span class="s1">#define ENCODER_B 13</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">#define SERVICE_UUIDÂ  Â  Â  Â  Â  Â  Â  "19b10000-e8f2-537e-4f6c-d104768a1214"</span></p>
<p class="p1"><span class="s1">#define SENSOR_CHARACTERISTIC_UUID "19b10001-e8f2-537e-4f6c-d104768a1214"</span></p>
<p class="p1"><span class="s1">#define LED_CHARACTERISTIC_UUIDÂ  Â  "19b10002-e8f2-537e-4f6c-d104768a1214"</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">BLEServer* pServer = NULL;</span></p>
<p class="p1"><span class="s1">BLECharacteristic* pSensorCharacteristic = NULL;</span></p>
<p class="p1"><span class="s1">BLECharacteristic* pLedCharacteristic = NULL;</span></p>
<p class="p1"><span class="s1">bool deviceConnected = false;</span></p>
<p class="p1"><span class="s1">bool oldDeviceConnected = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">double setpoint = 0, input = 0, output = 0;</span></p>
<p class="p1"><span class="s1">double Kp = 2.0, Ki = 5.0, Kd = 1.0;</span></p>
<p class="p1"><span class="s1">PID myPID(&amp;input, &amp;output, &amp;setpoint, Kp, Ki, Kd, DIRECT);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">volatile long encoderCount = 0;</span></p>
<p class="p1"><span class="s1">float currentRPM = 0;</span></p>
<p class="p1"><span class="s1">const int pulsesPerRev = 915;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const int pwmChannel = 0;</span></p>
<p class="p1"><span class="s1">const int pwmFreq = 5000;</span></p>
<p class="p1"><span class="s1">const int pwmResolution = 8;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">portMUX_TYPE mux = portMUX_INITIALIZER_UNLOCKED;</span></p>
<p class="p1"><span class="s1">hw_timer_t *timer = NULL;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">class MyServerCallbacks : public BLEServerCallbacks {</span></p>
<p class="p1"><span class="s1">Â Â void onConnect(BLEServer* pServer) { deviceConnected = true; }</span></p>
<p class="p1"><span class="s1">Â Â void onDisconnect(BLEServer* pServer) { deviceConnected = false; }</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">class MyCharacteristicCallbacks : public BLECharacteristicCallbacks {</span></p>
<p class="p1"><span class="s1">public:</span></p>
<p class="p1"><span class="s1">Â Â void onWrite(BLECharacteristic* pLedCharacteristic) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â std::string value = pLedCharacteristic-&gt;getValue();</span></p>
<p class="p1"><span class="s1">Â Â Â Â if (value.length() &gt; 0) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â int received = static_cast&lt;int&gt;(value[0]);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Serial.print("BLE Command Received: ");</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Serial.println(received);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â if (received &gt; 0) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â setpoint = received;</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â digitalWrite(IN1, HIGH);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â digitalWrite(IN2, LOW);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â } else {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â setpoint = 0;</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â digitalWrite(IN1, LOW);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â Â Â digitalWrite(IN2, LOW);</span></p>
<p class="p1"><span class="s1">Â Â Â Â Â Â }</span></p>
<p class="p1"><span class="s1">Â Â Â Â }</span></p>
<p class="p1"><span class="s1">Â Â }</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">void IRAM_ATTR onEncoderA() {</span></p>
<p class="p1"><span class="s1">Â Â portENTER_CRITICAL_ISR(&amp;mux);</span></p>
<p class="p1"><span class="s1">Â Â encoderCount++;</span></p>
<p class="p1"><span class="s1">Â Â portEXIT_CRITICAL_ISR(&amp;mux);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">void IRAM_ATTR calcRPM() {</span></p>
<p class="p1"><span class="s1">Â Â long count;</span></p>
<p class="p1"><span class="s1">Â Â portENTER_CRITICAL(&amp;mux);</span></p>
<p class="p1"><span class="s1">Â Â count = encoderCount;</span></p>
<p class="p1"><span class="s1">Â Â encoderCount = 0;</span></p>
<p class="p1"><span class="s1">Â Â portEXIT_CRITICAL(&amp;mux);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â currentRPM = (count * 60.0) / pulsesPerRev;</span></p>
<p class="p1"><span class="s1">Â Â input = currentRPM;</span></p>
<p class="p1"><span class="s1">Â Â myPID.Compute();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â ledcWrite(pwmChannel, constrain(output, 0, 255));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â if (deviceConnected) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â char buffer[8];</span></p>
<p class="p1"><span class="s1">Â Â Â Â dtostrf(currentRPM, 4, 1, buffer);</span></p>
<p class="p1"><span class="s1">Â Â Â Â pSensorCharacteristic-&gt;setValue(buffer);</span></p>
<p class="p1"><span class="s1">Â Â Â Â pSensorCharacteristic-&gt;notify();</span></p>
<p class="p1"><span class="s1">Â Â }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">void setup() {</span></p>
<p class="p1"><span class="s1">Â Â Serial.begin(115200);</span></p>
<p class="p1"><span class="s1">Â Â pinMode(IN1, OUTPUT);</span></p>
<p class="p1"><span class="s1">Â Â pinMode(IN2, OUTPUT);</span></p>
<p class="p1"><span class="s1">Â Â pinMode(ENCODER_A, INPUT_PULLUP);</span></p>
<p class="p1"><span class="s1">Â Â pinMode(ENCODER_B, INPUT_PULLUP);</span></p>
<p class="p1"><span class="s1">Â Â attachInterrupt(digitalPinToInterrupt(ENCODER_A), onEncoderA, RISING);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â ledcSetup(pwmChannel, pwmFreq, pwmResolution);</span></p>
<p class="p1"><span class="s1">Â Â ledcAttachPin(ENA, pwmChannel);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â myPID.SetMode(AUTOMATIC);</span></p>
<p class="p1"><span class="s1">Â Â myPID.SetOutputLimits(0, 255);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â BLEDevice::init("ESP32-MOTOR");</span></p>
<p class="p1"><span class="s1">Â Â pServer = BLEDevice::createServer();</span></p>
<p class="p1"><span class="s1">Â Â pServer-&gt;setCallbacks(new MyServerCallbacks());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â BLEService *pService = pServer-&gt;createService(SERVICE_UUID);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â pSensorCharacteristic = pService-&gt;createCharacteristic(</span></p>
<p class="p1"><span class="s1">Â Â Â Â SENSOR_CHARACTERISTIC_UUID,</span></p>
<p class="p1"><span class="s1">Â Â Â Â BLECharacteristic::PROPERTY_READ | BLECharacteristic::PROPERTY_NOTIFY</span></p>
<p class="p1"><span class="s1">Â Â );</span></p>
<p class="p1"><span class="s1">Â Â pSensorCharacteristic-&gt;addDescriptor(new BLE2902());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â pLedCharacteristic = pService-&gt;createCharacteristic(</span></p>
<p class="p1"><span class="s1">Â Â Â Â LED_CHARACTERISTIC_UUID,</span></p>
<p class="p1"><span class="s1">Â Â Â Â BLECharacteristic::PROPERTY_WRITE</span></p>
<p class="p1"><span class="s1">Â Â );</span></p>
<p class="p1"><span class="s1">Â Â pLedCharacteristic-&gt;setCallbacks(new MyCharacteristicCallbacks());</span></p>
<p class="p1"><span class="s1">Â Â pLedCharacteristic-&gt;addDescriptor(new BLE2902());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â pService-&gt;start();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();</span></p>
<p class="p1"><span class="s1">Â Â pAdvertising-&gt;addServiceUUID(SERVICE_UUID);</span></p>
<p class="p1"><span class="s1">Â Â pAdvertising-&gt;setScanResponse(true);Â  // </span><span class="s2">ğŸ‘ˆ</span><span class="s1"> GiÃºp hiá»‡n tÃªn vá»›i Chrome</span></p>
<p class="p1"><span class="s1">Â Â pAdvertising-&gt;setMinPreferred(0x06);</span></p>
<p class="p1"><span class="s1">Â Â pAdvertising-&gt;setMaxPreferred(0x12);</span></p>
<p class="p1"><span class="s1">Â Â BLEDevice::startAdvertising();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â Serial.println("BLE advertising... using scan response.");</span></p>
<p class="p1"><span class="s1">Â Â </span></p>
<p class="p1"><span class="s1">Â Â timer = timerBegin(0, 80, true);</span></p>
<p class="p1"><span class="s1">Â Â timerAttachInterrupt(timer, &amp;calcRPM, true);</span></p>
<p class="p1"><span class="s1">Â Â timerAlarmWrite(timer, 500000, true);</span></p>
<p class="p1"><span class="s1">Â Â timerAlarmEnable(timer);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">void loop() {</span></p>
<p class="p1"><span class="s1">Â Â if (!deviceConnected &amp;&amp; oldDeviceConnected) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â delay(500);</span></p>
<p class="p1"><span class="s1">Â Â Â Â pServer-&gt;startAdvertising();</span></p>
<p class="p1"><span class="s1">Â Â Â Â Serial.println("Re-advertising BLE...");</span></p>
<p class="p1"><span class="s1">Â Â Â Â oldDeviceConnected = false;</span></p>
<p class="p1"><span class="s1">Â Â }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Â Â if (deviceConnected &amp;&amp; !oldDeviceConnected) {</span></p>
<p class="p1"><span class="s1">Â Â Â Â Serial.println("Device connected.");</span></p>
<p class="p1"><span class="s1">Â Â Â Â oldDeviceConnected = true;</span></p>
<p class="p1"><span class="s1">Â Â }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
</body>
</html>
